\chapter{Optimizations on intermediate representation}

\section{Static single assignment form}

While not an optimization in itself, static single assignment (SSA)
form is a prerequisite for many optimization techniques, which is why
we describe it here. 

In their conference paper from 2013
\cite{Braun:2013:SEC:2450247.2450258}, Braun et al present an
algorithm capable of a direct translation of abstract syntax trees to
SSA form.  We do not use it here, because we have not been able to
couple it with our compilation context which seems to require
compilation from the end to the beginning of the program. 

Instead, we use the traditional technique based on \emph{iterated
  dominance frontiers}.

Muchnick \cite{Muchnick:1998:ACD:286076} discusses SSA form, but the
description is very sketchy.  He describes using iterated dominance
frontiers to find nodes where $\phi$ functions must be inserted, but
he does not discuss how to rename variables.  He also does not justify
why the start node of the control flow graph is included in the
argument to each computation using iterated dominance frontiers.  His
notation is essentially the same as that of Cytron et al
\cite{Cytron:1991:ECS:115372.115320}.  For these reasons, we base our
description on the paper by Cytron et al, rather than on Muchnick's
book.

SSA form is a per-variable property.  Some optimizations are possible
even if not every variable has this property, so that some variables
are assigned multiple times.  In order for a variable $V$ to respect
the SSA property, a $\phi$ function for $V$ is required in control
flow node $Z$ whenever there are control flow nodes $X$ and $Y$
containing assignments to $V$, $X \ne Y$, $X \rightarrow^+ Z$, $Y
\rightarrow^+ Z$.  The node $Z$ is called a \emph{join point} for $V$.
Since adding a $\phi$ function in $Z$ introduces an assignment to $V$,
$Z$ must then recursively be considered in order to find other join
points requiring additional $\phi$ functions.  The concept of a join
point is more generally defined for an arbitrary set of control flow
nodes $S$.  The set of join points $J(S)$ is defined as the set of all
nodes $Z$ such that there are two non-null paths starting from two
distinct nodes $X$ and $Y$ in S and converge in $Z$. 

\begin{figure}
\begin{center}
\inputfig{fig-ssa-join-1.pdf_t}
\end{center}
\caption{\label{fig-ssa-join-1}
Example of join point.}
\end{figure}

