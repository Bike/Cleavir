<!DOCTYPE html> <html lang="EN"> <head> <meta charset="utf-8"> <title>Cleavir Example</title> <style>html body{margin:0 auto 0 auto;padding:20px;max-width:1024px;font-family:sans-serif;font-size:14pt;overflow-y:scroll;}html body a{text-decoration:none;}html body a[href]{color:#0055AA;}html body a[href]:hover{color:#0088EE;}html body pre{background:#FAFAFA;border:1px solid #DDDDDD;padding:0.75em;overflow-x:auto;}html body pre >code a[href]{color:#223388;}article.project h1{font-size:1.7em;}article.project h1,article.project h2,article.project h3,article.project h4,article.project h5,article.project h6{margin:0.2em 0 0.1em 0;text-indent:1em;}article.project >header{text-align:center;}article.project >header img.logo{display:block;margin:auto;max-height:170px;}article.project >header h1{display:inline-block;text-indent:0;font-size:2.5em;}article.project >header .version{vertical-align:bottom;}article.project >header .languages{margin-top:-0.5em;text-transform:capitalize;}article.project >header .description{margin:0;}article.project >header .pages{margin-top:0.5em;font-size:1.2em;text-transform:capitalize;}article.project >header .pages a{display:inline-block;padding:0 0.2em;}article.project >section{margin:1em 0 1em 0;}article.project #index >ul{list-style:none;margin:0;padding:0;}article.project .row label{display:inline-block;min-width:8em;}article.project #system .row{display:flex;}article.project #system #dependencies{display:inline;margin:0;padding:0;}article.project #system #dependencies li{display:inline;padding:0 0.2em;}article.project #system #author label{vertical-align:top;}article.project #system #author ul{display:inline-block;margin:0;padding:0;list-style:none;}article.definition{margin:1em 0 0 0;}article.definition >header h1,article.definition >header h2,article.definition >header h3,article.definition >header h4,article.definition >header h5,article.definition >header h6{text-indent:0;display:inline-block;}article.definition >header ul{display:inline-block;list-style:none;margin:0;padding:0;}article.definition >header ul li{display:inline-block;padding:0 0.2em 0 0;}article.definition >header .visibility{display:none;}article.definition >header .visibility,article.definition >header .type{text-transform:lowercase;}article.definition >header .source-link{visibility:hidden;float:right;}article.definition >header .source-link:after{visibility:visible;content:"[SRC]";}article.definition .docstring{margin:0 0 0 1em;}article.definition .docstring pre{font-size:0.8em;white-space:pre-wrap;}.definition.package >header ul.nicknames{display:inline-block;list-style:none;margin:0;padding:0 0 0 1em;}.definition.package >header ul.nicknames li{display:inline;}.definition.package >header ul.nicknames:before{content:"(";}.definition.package >header ul.nicknames:after{content:")";}.definition.package ul.definitions{margin:0;list-style:none;padding:0 0 0 0.5em;}.definition.callable >header .name:before,.definition.type >header .name:before{content:"(";font-weight:normal;}.definition.callable >header .arguments:after,.definition.type >header .arguments:after{content:")";}.definition.callable >header .arguments .arguments:before,.definition.type >header .arguments .arguments:before{content:"(";}.definition.callable >header .arguments .argument,.definition.type >header .arguments .argument{padding:0;}.definition.callable >header .arguments .argument.lambda-list-keyword,.definition.type >header .arguments .argument.lambda-list-keyword{color:#991155;}.definition li>mark{background:none;border-left:0.3em solid #0088EE;padding-left:0.3em;display:block;}</style> </head> <body> <article class="project"> <header>   <h1>cleavir example</h1>   <span class="version">1.0.0</span>    <p class="description">Example frontend for the Cleavir toolkit.</p>   </header> <section id="documentation"><p>Cleavir is a collection of parts that can be used to make a Lisp compiler. A Lisp compiler is closely linked to the Lisp runtime, both in that it must target the runtime, and it must sometimes actually use it to evaluate Lisp code. As such, Cleavir cannot operate as an independent system.</p> <p>This makes it harder to get started on understanding and using Cleavir. To rectify this problem, this directory defines a small system making a subset of Common Lisp available, and demonstrates how to use Cleavir as a compiler for this system.</p> <h1 id="getting_started">Getting started</h1> <ol> <li>Load the <code>cleavir-example</code> system. Besides Cleavir systems, it depends on the external systems <code>concrete-syntax-tree</code> and <code>acclimation</code>, both of which should be available from Quicklisp.</li> <li>Run <code>(cleavir-example:load-environment)</code> to set up the compilation environment.</li> <li>You can now compile a subset of Lisp code to BIR (Cleavir's intermediate representation). Try <code>(cleavir-example:frontend (cst:cst-from-expression '(lambda (x) x)))</code>, for example.</li> <li>This will return a BIR &quot;module&quot;. You can display a disassembly of this module with <code>(cleavir-bir-disassembler:display module)</code>.</li> </ol> <h1 id="using_the_visualizer">Using the visualizer</h1> <p>This example system can be used with the BIR visualizer (in BIR/Visualizer) as follows:</p> <ol> <li>Load the <code>cleavir-example</code> and <code>cleavir-bir-visualizer</code> systems.</li> <li>Run <code>(cleavir-example:load-environment)</code> to set up the compilation environment.</li> <li>Run <code>(cleavir.bir.visualizer:run :environment cleavir-example:*environment* :system cleavir-example:*system*)</code> to start the visualizer. <code>:new-process t</code> can additionally be passed in order to run the visualizer in a new thread, freeing up your REPL.</li> <li>Enter code in the &quot;Lambda Expression&quot; field (or leave the default), use the Safe/Default/Fast buttons and the optimize sliders to run a compilation, and freely inspect the IR in the &quot;Intermediate Representation&quot; tab.</li> </ol> <h1 id="limitations">Limitations</h1> <p>The example system only includes a subset of Common Lisp. Most obviously, only a few basic macros like <code><a href="#MACRO-FUNCTION%20CLEAVIR-EXAMPLE%3ALAMBDA" class="xref">lambda</a></code>, <code><a href="#MACRO-FUNCTION%20CLEAVIR-EXAMPLE%3ACOND" class="xref">cond</a></code>, and <code><a href="#MACRO-FUNCTION%20CLEAVIR-EXAMPLE%3ADOLIST" class="xref">dolist</a></code> are defined (the complete listing is in macros.lisp). The example system must define all of its own macros, because host system macros (i.e. the macros defined by your Lisp implementation) may expand into nonstandard code that the example system does not know how to process.</p> <p>Some standard special operators are not implemented by the basic Cleavir system due to requiring some runtime coordination. These are <code><a href="#SPECIAL-OPERATOR%20CLEAVIR-EXAMPLE%3ACATCH" class="xref">catch</a></code>, <code><a href="#SPECIAL-OPERATOR%20CLEAVIR-EXAMPLE%3APROGV" class="xref">progv</a></code>, <code><a href="#SPECIAL-OPERATOR%20CLEAVIR-EXAMPLE%3ATHROW" class="xref">throw</a></code>, and <code><a href="#SPECIAL-OPERATOR%20CLEAVIR-EXAMPLE%3AUNWIND-PROTECT" class="xref">unwind-protect</a></code>. Similarly, special variable binding is by default implemented as a function call. The example client implements the special operators as macros expanding into function calls. A full client would probably specify dedicated ASTs and IR for representing these operators.</p> <p>Cleavir does not include a backend, since a real full backend more or less requires an entire accompanying Lisp implementation, in order for the details of how code is laid out and run, etc., to be defined. Clients of Cleavir can define their own backends. For example, <a href="https://github.com/clasp-developers/clasp">Clasp</a> translates BIR into LLVM-IR, which is then passed to LLVM to generate machine code.</p> </section>   <section id="system"> <h2>System Information</h2>  <div class="row"> <label for="version">Version:</label> <a id="version">1.0.0</a> </div>   <div class="row"> <label for="dependencies">Dependencies:</label> <ul id="dependencies"><li><a class="external" href="https://s-expressionists.github.io/Cleavir/">cleavir-ctype</a></li><li><a class="external" href="https://s-expressionists.github.io/Cleavir/">cleavir-environment</a></li><li><a class="external" href="https://s-expressionists.github.io/Cleavir/">cleavir-compilation-policy</a></li><li><a class="external" href="https://s-expressionists.github.io/Cleavir/">cleavir-primop</a></li><li><a class="external" href="https://s-expressionists.github.io/Cleavir/">cleavir-cst-to-ast</a></li><li><a class="external" href="https://s-expressionists.github.io/Cleavir/">cleavir-ast-to-bir</a></li><li><a class="external">cleavir-bir-transformations</a></li><li><a class="external">cleavir-abstract-interpreter</a></li><li><a class="external">concrete-syntax-tree</a></li><li><a class="external">ctype</a></li><li><a class="external">ctype-tfun</a></li></ul> </div>   <div class="row" id="author"> <label for="author">Author:</label> <a href="mailto:aeshtaer@gmail.com">Bike</a> </div>   <div class="row"> <label for="license">License:</label> <a id="license" href="https://tldrlegal.com/search?q=BSD">BSD</a> </div>   <div class="row"> <label for="homepage">Homepage:</label> <a id="homepage" href="https://s-expressionists.github.io/Cleavir/">https://s-expressionists.github.io/Cleavir/</a> </div>   <div class="row"> <label for="sources">Sources:</label> <a id="sources" href="https://github.com/s-expressionists/Cleavir.git">https://github.com/s-expressionists/Cleavir.git</a> </div>  </section>    <section id="index"> <h2>Definition Index</h2> <ul> <li> <article class="definition package" id="PACKAGE CLEAVIR-EXAMPLE"> <header> <h3> <a href="#PACKAGE%20CLEAVIR-EXAMPLE">CLEAVIR-EXAMPLE</a> </h3> <ul class="nicknames"></ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> <ul class="definitions"> <li> <article class="definition special-variable" id="VARIABLE CLEAVIR-EXAMPLE:*ENVIRONMENT*"> <header> <span class="visibility">EXTERNAL</span> <span class="type">SPECIAL-VARIABLE</span> <h4 class="name"> <a href="#VARIABLE%20CLEAVIR-EXAMPLE%3A%2AENVIRONMENT%2A">*ENVIRONMENT*</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/s-expressionists/Cleavir/blob/main/Example/environment.lisp">Source</a>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition special-variable" id="VARIABLE CLEAVIR-EXAMPLE:*SYSTEM*"> <header> <span class="visibility">EXTERNAL</span> <span class="type">SPECIAL-VARIABLE</span> <h4 class="name"> <a href="#VARIABLE%20CLEAVIR-EXAMPLE%3A%2ASYSTEM%2A">*SYSTEM*</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/s-expressionists/Cleavir/blob/main/Example/system.lisp">Source</a>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition function callable" id="FUNCTION CLEAVIR-EXAMPLE:FRONTEND"> <header> <span class="visibility">EXTERNAL</span> <span class="type">FUNCTION</span> <h4 class="name"> <a href="#FUNCTION%20CLEAVIR-EXAMPLE%3AFRONTEND">FRONTEND</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">CST</li>  </ul>  <a class="source-link" href="https://github.com/s-expressionists/Cleavir/blob/main/Example/compile.lisp">Source</a>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition function callable" id="FUNCTION CLEAVIR-EXAMPLE:LOAD-ENVIRONMENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">FUNCTION</span> <h4 class="name"> <a href="#FUNCTION%20CLEAVIR-EXAMPLE%3ALOAD-ENVIRONMENT">LOAD-ENVIRONMENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument lambda-list-keyword">&amp;OPTIONAL</li>    <li class="argument">ENV</li>  </ul>  <a class="source-link" href="https://github.com/s-expressionists/Cleavir/blob/main/Example/load-environment.lisp">Source</a>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li> </ul> </article> </li> </ul> </section>  </article> <script>window.addEventListener("DOMContentLoaded", function(){
    var unmarkElement = function(el){
        if(el.tagName === "mark" || el.tagName === "MARK"){
            [].forEach.call(el.childNodes, function(child){
                el.parentNode.insertBefore(child, el);
            });
            el.parentNode.removeChild(el);
        }else if(el.parentNode.tagName === "mark"){
            return unmarkElement(el.parentNode);
        }
        return null;
    }

    var unmarkAll = function(root){
        root = root || document;
        [].forEach.call(root.querySelectorAll("mark"), unmarkElement);
    }
    
    var markElement = function(el){
        if(el.parentNode.tagName === "mark" || el.parentNode.tagName === "MARK"){
            return el.parentNode;
        } else {
            unmarkAll();
            var marked = document.createElement("mark");
            el.parentNode.insertBefore(marked, el);
            marked.appendChild(el);
            return marked;
        }
    }

    var markFragmented = function(){
        if(window.location.hash){
            var el = document.getElementById(decodeURIComponent(window.location.hash.substr(1)));
            if(el) markElement(el);
        }
    }

    var registerXrefLink = function(link){
        var el = document.getElementById(decodeURIComponent(link.getAttribute("href").substr(1)));
        if(el){
            link.addEventListener("click", function(){
                markElement(el);
            });
        }
    }

    var registerXrefLinks = function(root){
        root = root || document;
        [].forEach.call(root.querySelectorAll("a.xref"), registerXrefLink);
    }

    markFragmented();
    registerXrefLinks();
}); </script> </body> </html> 